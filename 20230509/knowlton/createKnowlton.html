<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
   
</head>

<body>

    <script>
        
        let gridCol=80;
        let gridRow=80;
        let rasterbreite;
        let rasterhoehe;

        let img;
        let str;
        let pos=0; //position string
        
        function preload(){
            img = loadImage('lincoln.jpg');
            str = loadStrings('lincoln.txt');
            
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            rasterbreite=img.width/gridCol;
            rasterhoehe=img.height/gridRow;
            textSize(rasterhoehe*1.2);
            textFont("Courier")
            noStroke();
            //image(img,0,0)
            noLoop();

            str=str.join();//https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join?retiredLocale=de
            
        }

        function draw() {
           
           
                    for(let y=0;y<img.height-1;y=y+rasterhoehe){
                        for(let x=0;x<img.width-1;x=x+rasterbreite){
                        let c = img.get(x+rasterbreite/2,y+rasterhoehe/2);
                        
                        let b=int(brightness(c));
                        b=(c[0]+c[1]+c[2]) /3;

                        let s=map(b,0,255,0.5,1);

                        push();
                        translate(x,y);
                        scale(s);
                        
                        
                        let char = str.substring(pos, pos+1);
                        //console.log(char)
                        //invert
                        let r=255-c[0];
                        let g=255-c[1];
                        let blue=255-c[2];
                        fill(r,g,b);
                        noStroke();
                        if(b < 64){
                            textStyle(NORMAL);
                        }else{
                            textStyle(BOLD);
                        }
                        if(b>127){
                            strokeWeight(map(b,127,255,1,2));
                            stroke(r,g,b);
                        }
                        text(char, 0,0);
                        //rectMode(CENTER);
                        //rect(0,0,rasterbreite, rasterhoehe);
                        pop();
                        pos++;
                        if(pos>str.length-2){
                            pos=0;
                        }
                    }
                }

        }

    </script>
</body>

</html>